<h2> Edit Task </h2>
<div class="task-creation-form">
  <%= form_with(model: @task, local: true) do |form| %>
      <div class="form-grid">
        <div class="form-left">
          <div class="form-group">
            <%= form.label :title, maxlength: 50 %>
            <%= form.text_field :title %>
          </div>
        
          <div class="form-group">
            <%= form.label :description, maxlength: 255 %>
            <%= form.text_area :description %>
          </div>
        
          <div class="form-group">
            <%= form.label :deadline_date, "Deadline Date: Date of first occurrence." %>
            <%= form.date_select :deadline_date %>
          </div>
        
          <div class="form-group">
            <%= form.label :deadline_type, "Deadline Type" %>
            <%= form.select :deadline_type, Task::DEADLINE_TYPES.map { |d| [d.humanize, d] } %>
          </div>
        
          <div class="form-group">
            <%= form.label :recurrence, "Recurrence Frequency" %>
           <%= form.select :recurrence,
              Task::RECURRENCE_OPTIONS.map { |r| [r.humanize, r] },
              {}, { id: "task_recurrence" } %>


            <div id="custom_recurrence_section">
              <%= form.number_field :custom_recurrence_number,
                min: 1,
                placeholder: "Enter number",
                class: "form-group" %>

              <%= form.select :custom_recurrence_unit,
                    [["Days", "days"], ["Weeks", "weeks"], ["Months", "months"], ["Years", "years"]],
                    {}, { class: "form-group" } %>
  </div>

            </div>
        </div>

        <div class="form-right">
          <div class="form-group">
            <%= form.label :urgency %>
            <%= form.select :urgency, Task::URGENCY_OPTIONS.map { |u| [u.humanize, u] } %>
          </div>

          <div class="form-group">
            <%= form.label :category %>
            <%= form.select :category, ['Appliance Maintenance', 'Car Maintenance', 'Documents / Licenses', 'Misc.', 'Custom'] %>
            <%= form.text_field :custom_category,
              placeholder: "Enter new category name",
              id: "custom_category_field",
              maxlength: 25 %>

            </div>
         
          <%= form.submit "Update Task" %>
        </div>
      </div>
  <% end %>
</div>

<script>
  document.addEventListener("turbo:load", function() {
    const categorySelect = document.querySelector("#task_category");
    const categoryCustom = document.querySelector("#custom_category_field");
    const recurrenceSelect = document.querySelector("#task_recurrence");
    const recurrenceCustom = document.querySelector("#custom_recurrence_section");

    function toggle(selectEl, fieldEl, customValue = "custom") {
      if (!selectEl || !fieldEl) return;
      
     const show = (selectEl.value.toLowerCase() === customValue.toLowerCase());

      fieldEl.style.display = show ? "block" : "none";
      if (!show) {
        fieldEl.querySelectorAll("input, select").forEach(el => el.value = "");
      }
    }

    function runToggles() {
      toggle(categorySelect, categoryCustom);
      toggle(recurrenceSelect, recurrenceCustom);
    }

    runToggles();

    // Toggle on change
    categorySelect?.addEventListener("change", () => toggle(categorySelect, categoryCustom));
    recurrenceSelect?.addEventListener("change", () => toggle(recurrenceSelect, recurrenceCustom));
  
  });


</script>